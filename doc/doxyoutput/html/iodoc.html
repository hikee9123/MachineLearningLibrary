<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mlpack: Writing an mlpack binding</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra-stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mlpack
   &#160;<span id="projectnumber">3.4.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Writing an mlpack binding </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="iointro"></a>
Introduction</h1>
<p>This tutorial gives some simple examples of how to write an mlpack binding that can be compiled for multiple languages. These bindings make up the core of how most users will interact with mlpack.</p>
<p>mlpack provides the following:</p>
<ul>
<li>mlpack::Log, for debugging / informational / warning / fatal output</li>
<li><a class="el" href="classmlpack_1_1IO.html" title="Parses the command line for parameters and holds user-specified parameters. ">mlpack::IO</a>, for parsing command line options or other option</li>
</ul>
<p>Each of those classes are well-documented, and that documentation should be consulted for further reference.</p>
<p>First, we'll discuss the logging infrastructure, which is useful for giving output that users can see.</p>
<h1><a class="anchor" id="simplelog"></a>
Simple Logging Example</h1>
<p>mlpack has four logging levels:</p>
<ul>
<li>Log::Debug</li>
<li>Log::Info</li>
<li>Log::Warn</li>
<li>Log::Fatal</li>
</ul>
<p>Output to Log::Debug does not show (and has no performance penalty) when mlpack is compiled without debugging symbols. Output to Log::Info is only shown when the program is run with the <code>&ndash;verbose</code> (or <code>-v</code>) flag. Log::Warn is always shown, and Log::Fatal will throw a std::runtime_error exception, after a newline is sent to it. If mlpack was compiled with debugging symbols, Log::Fatal will also print a backtrace, if the necessary libraries are available.</p>
<p>Here is a simple example binding, and its output. Note that instead of <code>int</code> <code>main()</code>, we use <code>static</code> <code>void</code> <code>mlpackMain()</code>. This is because the automatic binding generator (see bindings) will set up the environment and once that is done, it will call <code>mlpackMain()</code>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="core_8hpp.html">mlpack/core.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="io_8hpp.html">mlpack/core/util/io.hpp</a>&gt;</span></div><div class="line"><span class="comment">// This definition below means we will only compile for the command line.</span></div><div class="line"><span class="preprocessor">#define BINDING_TYPE BINDING_TYPE_CLI</span></div><div class="line"><span class="preprocessor">#include &lt;mlpack/core/util/mlpack_main.hpp&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacemlpack.html">mlpack</a>;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> mlpackMain()</div><div class="line">{</div><div class="line">  Log::Debug &lt;&lt; <span class="stringliteral">&quot;Compiled with debugging symbols.&quot;</span> &lt;&lt; std::endl;</div><div class="line"></div><div class="line">  Log::Info &lt;&lt; <span class="stringliteral">&quot;Some test informational output.&quot;</span> &lt;&lt; std::endl;</div><div class="line"></div><div class="line">  Log::Warn &lt;&lt; <span class="stringliteral">&quot;A warning!&quot;</span> &lt;&lt; std::endl;</div><div class="line"></div><div class="line">  Log::Fatal &lt;&lt; <span class="stringliteral">&quot;Program has crashed.&quot;</span> &lt;&lt; std::endl;</div><div class="line"></div><div class="line">  Log::Warn &lt;&lt; <span class="stringliteral">&quot;Made it!&quot;</span> &lt;&lt; std::endl;</div><div class="line">}</div></div><!-- fragment --><p>Assuming mlpack is installed on the system and the code above is saved in <code>test.cpp</code>, this program can be compiled with the following command:</p>
<div class="fragment"><div class="line">$ g++ -o test test.cpp -DDEBUG -g -rdynamic -lmlpack</div></div><!-- fragment --><p>Since we compiled with <code>-DDEBUG</code>, if we run the program as below, the following output is shown:</p>
<div class="fragment"><div class="line">$ ./test --verbose</div><div class="line">[DEBUG] Compiled with debugging symbols.</div><div class="line">[INFO ] Some test informational output.</div><div class="line">[WARN ] A warning!</div><div class="line">[FATAL] [bt]: (1) /absolute/path/to/file/example.cpp:6: <span class="keyword">function</span>()</div><div class="line">[FATAL] Program has crashed.</div><div class="line">terminate called after throwing an instance of <span class="stringliteral">&#39;std::runtime_error&#39;</span></div><div class="line">  what():  fatal error; see Log::Fatal output</div><div class="line">Aborted</div></div><!-- fragment --><p>The flags <code>-g</code> and <code>-rdynamic</code> are only necessary for providing a backtrace. If those flags are not given during compilation, the following output would be shown:</p>
<div class="fragment"><div class="line">$ ./test --verbose</div><div class="line">[DEBUG] Compiled with debugging symbols.</div><div class="line">[INFO ] Some test informational output.</div><div class="line">[WARN ] A warning!</div><div class="line">[FATAL] Cannot give backtrace because program was compiled without: -g -rdynamic</div><div class="line">[FATAL] For a backtrace, recompile with: -g -rdynamic.</div><div class="line">[FATAL] Program has crashed.</div><div class="line">terminate called after throwing an instance of <span class="stringliteral">&#39;std::runtime_error&#39;</span></div><div class="line">  what():  fatal error; see Log::Fatal output</div><div class="line">Aborted</div></div><!-- fragment --><p>The last warning is not reached, because Log::Fatal terminates the program.</p>
<p>Without debugging symbols (i.e. without <code>-g</code> and <code>-DDEBUG</code>) and without &ndash;verbose, the following is shown:</p>
<div class="fragment"><div class="line">$ ./test</div><div class="line">[WARN ] A warning!</div><div class="line">[FATAL] Program has crashed.</div><div class="line">terminate called after throwing an instance of <span class="stringliteral">&#39;std::runtime_error&#39;</span></div><div class="line">  what():  fatal error; see Log::Fatal output</div><div class="line">Aborted</div></div><!-- fragment --><p>These four outputs can be very useful for both providing informational output and debugging output for your mlpack program.</p>
<h1><a class="anchor" id="simpleio"></a>
Simple IO Example</h1>
<p>Through the <a class="el" href="classmlpack_1_1IO.html" title="Parses the command line for parameters and holds user-specified parameters. ">mlpack::IO</a> object, command-line parameters can be easily added with the BINDING_NAME, BINDING_SHORT_DESC, BINDING_LONG_DESC, BINDING_EXAMPLE, BINDING_SEE_ALSO, PARAM_INT, PARAM_DOUBLE, PARAM_STRING, and PARAM_FLAG macros.</p>
<p>Here is a sample use of those macros, extracted from methods/pca/pca_main.cpp. (Some details have been omitted from the snippet below.)</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="core_8hpp.html">mlpack/core.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="io_8hpp.html">mlpack/core/util/io.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;mlpack/core/util/mlpack_main.hpp&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// Program Name.</span></div><div class="line">BINDING_NAME(<span class="stringliteral">&quot;Principal Components Analysis&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// Short description.</span></div><div class="line">BINDING_SHORT_DESC(</div><div class="line">    <span class="stringliteral">&quot;An implementation of several strategies for principal components analysis &quot;</span></div><div class="line">    <span class="stringliteral">&quot;(PCA), a common preprocessing step.  Given a dataset and a desired new &quot;</span></div><div class="line">    <span class="stringliteral">&quot;dimensionality, this can reduce the dimensionality of the data using the &quot;</span></div><div class="line">    <span class="stringliteral">&quot;linear transformation determined by PCA.&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// Long description.</span></div><div class="line">BINDING_LONG_DESC(</div><div class="line">    <span class="stringliteral">&quot;This program performs principal components analysis on the given dataset &quot;</span></div><div class="line">    <span class="stringliteral">&quot;using the exact, randomized, randomized block Krylov, or QUIC SVD method. &quot;</span></div><div class="line">    <span class="stringliteral">&quot;It will transform the data onto its principal components, optionally &quot;</span></div><div class="line">    <span class="stringliteral">&quot;performing dimensionality reduction by ignoring the principal components &quot;</span></div><div class="line">    <span class="stringliteral">&quot;with the smallest eigenvalues.&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// See also...</span></div><div class="line">BINDING_SEE_ALSO(<span class="stringliteral">&quot;Principal component analysis on Wikipedia&quot;</span>,</div><div class="line">        <span class="stringliteral">&quot;https://en.wikipedia.org/wiki/Principal_component_analysis&quot;</span>);</div><div class="line">BINDING_SEE_ALSO(<span class="stringliteral">&quot;mlpack::pca::PCA C++ class documentation&quot;</span>,</div><div class="line">        <span class="stringliteral">&quot;@doxygen/classmlpack_1_1pca_1_1PCA.html&quot;</span>));</div><div class="line"></div><div class="line"><span class="comment">// Parameters for program.</span></div><div class="line">PARAM_MATRIX_IN_REQ(<span class="stringliteral">&quot;input&quot;</span>, <span class="stringliteral">&quot;Input dataset to perform PCA on.&quot;</span>, <span class="stringliteral">&quot;i&quot;</span>);</div><div class="line">PARAM_MATRIX_OUT(<span class="stringliteral">&quot;output&quot;</span>, <span class="stringliteral">&quot;Matrix to save modified dataset to.&quot;</span>, <span class="stringliteral">&quot;o&quot;</span>);</div><div class="line">PARAM_INT_IN(<span class="stringliteral">&quot;new_dimensionality&quot;</span>, <span class="stringliteral">&quot;Desired dimensionality of output dataset.&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;d&quot;</span>, 0);</div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacemlpack.html">mlpack</a>;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> mlpackMain()</div><div class="line">{</div><div class="line">  <span class="comment">// Load input dataset.</span></div><div class="line">  arma::mat&amp; dataset = IO::GetParam&lt;arma::mat&gt;(<span class="stringliteral">&quot;input&quot;</span>);</div><div class="line"></div><div class="line">  <span class="keywordtype">size_t</span> newDimension = IO::GetParam&lt;int&gt;(<span class="stringliteral">&quot;new_dimensionality&quot;</span>);</div><div class="line"></div><div class="line">  ...</div><div class="line"></div><div class="line">  <span class="comment">// Now save the results.</span></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="classmlpack_1_1IO.html#a39eda1093ba2453f2b66d37153ac542c">IO::HasParam</a>(<span class="stringliteral">&quot;output&quot;</span>))</div><div class="line">    IO::GetParam&lt;arma::mat&gt;(<span class="stringliteral">&quot;output&quot;</span>) = std::move(dataset);</div><div class="line">}</div></div><!-- fragment --><p>Documentation is automatically generated using those macros, and when the program is run with &ndash;help the following is displayed:</p>
<div class="fragment"><div class="line">$ mlpack_pca --help</div><div class="line">Principal Components Analysis</div><div class="line"></div><div class="line">  This program performs principal components analysis on the given dataset.  It</div><div class="line">  will transform the data onto its principal components, optionally performing</div><div class="line">  dimensionality reduction by ignoring the principal components with the</div><div class="line">  smallest eigenvalues.</div><div class="line"></div><div class="line">Required options:</div><div class="line"></div><div class="line">  --input_file [string]         Input dataset to perform PCA on.</div><div class="line">  --output_file [string]        Matrix to save modified dataset to.</div><div class="line"></div><div class="line">Options:</div><div class="line"></div><div class="line">  --help (-h)                   Default help info.</div><div class="line">  --info [string]               Get help on a specific module or option.</div><div class="line">                                Default value <span class="stringliteral">&#39;&#39;</span>.</div><div class="line">  --new_dimensionality [int]    Desired dimensionality of output dataset.</div><div class="line">                                Default value 0.</div><div class="line">  --verbose (-v)                Display informational messages and the full list</div><div class="line">                                of parameters and timers at the end of</div><div class="line">                                execution.</div></div><!-- fragment --><p>The <a class="el" href="classmlpack_1_1IO.html" title="Parses the command line for parameters and holds user-specified parameters. ">mlpack::IO</a> documentation can be consulted for further and complete documentation. Also useful is to look at other example bindings, found in <code>src/mlpack/methods/</code>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
<script type="text/javascript">
var x = document.querySelectorAll("img.formulaDsp");
var i;
for (i = 0; i < x.length; i++)
{
  x[i].width = x[i].offsetWidth / 4;
}
</script>
</html>
