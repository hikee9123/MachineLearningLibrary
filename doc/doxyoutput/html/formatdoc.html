<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mlpack: File formats and loading data in mlpack</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra-stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mlpack
   &#160;<span id="projectnumber">3.4.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">File formats and loading data in mlpack </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="formatintro"></a>
Introduction</h1>
<p>mlpack supports a wide variety of data (including images) and model formats for use in both its command-line programs and in C++ programs using mlpack via the <a class="el" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831" title="Loads a matrix from file, guessing the filetype from the extension. ">mlpack::data::Load()</a> function. This tutorial discusses the formats that are supported and how to use them.</p>
<h1><a class="anchor" id="toc_tut"></a>
Table of Contents</h1>
<p>This tutorial is split into the following sections:</p>
<ul>
<li><a class="el" href="formatdoc.html#formatintro">Introduction</a></li>
<li><a class="el" href="formatdoc.html#toc_tut">Table of Contents</a></li>
<li>Data<ul>
<li>Data Formats<ul>
<li><a class="el" href="formatdoc.html#formatsimple">Simple examples to load data in C++</a></li>
<li><a class="el" href="formatdoc.html#formattypes">Supported dataset types</a></li>
<li><a class="el" href="formatdoc.html#formatcpp">Loading simple matrices in C++</a></li>
<li><a class="el" href="formatdoc.html#sparseload">Dealing with sparse matrices</a></li>
<li><a class="el" href="formatdoc.html#formatcat">Categorical features and command line programs</a></li>
<li><a class="el" href="formatdoc.html#formatcatcpp">Categorical features and C++</a></li>
</ul>
</li>
<li>Image Support<ul>
<li><a class="el" href="formatdoc.html#intro_imagetut">Loading and Saving Images</a></li>
<li><a class="el" href="formatdoc.html#model_api_imagetut">Image Utilities API</a></li>
<li><a class="el" href="formatdoc.html#imageinfo_api_imagetut">Accessing Metadata of Images: ImageInfo</a></li>
<li><a class="el" href="formatdoc.html#load_api_imagetut">Loading Images in C++</a></li>
<li><a class="el" href="formatdoc.html#save_api_imagetut">Saving Images in C++</a></li>
</ul>
</li>
</ul>
</li>
<li>Models<ul>
<li><a class="el" href="formatdoc.html#formatmodels">Loading and saving models</a></li>
<li><a class="el" href="formatdoc.html#formatmodelscpp">Loading and saving models in C++</a></li>
</ul>
</li>
<li><a class="el" href="formatdoc.html#formatfinal">Final notes</a></li>
</ul>
<h1><a class="anchor" id="formatsimple"></a>
Simple examples to load data in C++</h1>
<p>The example code snippets below load data from different formats into an Armadillo matrix object (<code>arma::mat</code>) or model when using C++.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacemlpack.html">mlpack</a>;</div><div class="line"></div><div class="line">arma::mat matrix1;</div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">data::Load</a>(<span class="stringliteral">&quot;dataset.csv&quot;</span>, matrix1);</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacemlpack.html">mlpack</a>;</div><div class="line"></div><div class="line">arma::mat matrix2;</div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">data::Load</a>(<span class="stringliteral">&quot;dataset.bin&quot;</span>, matrix2);</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacemlpack.html">mlpack</a>;</div><div class="line"></div><div class="line">arma::mat matrix3;</div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">data::Load</a>(<span class="stringliteral">&quot;dataset.h5&quot;</span>, matrix3);</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacemlpack.html">mlpack</a>;</div><div class="line"></div><div class="line"><span class="comment">// ARFF loading is a little different, since sometimes mapping has to be done</span></div><div class="line"><span class="comment">// for string types.</span></div><div class="line">arma::mat matrix4;</div><div class="line"><a class="code" href="classmlpack_1_1data_1_1DatasetMapper.html">data::DatasetInfo</a> datasetInfo;</div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">data::Load</a>(<span class="stringliteral">&quot;dataset.arff&quot;</span>, matrix4, datasetInfo);</div><div class="line"></div><div class="line"><span class="comment">// The datasetInfo object now holds information about each dimension.</span></div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacemlpack.html">mlpack</a>;</div><div class="line"></div><div class="line"><a class="code" href="classmlpack_1_1regression_1_1LogisticRegression.html">regression::LogisticRegression</a> lr;</div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">data::Load</a>(<span class="stringliteral">&quot;model.bin&quot;</span>, <span class="stringliteral">&quot;logistic_regression_model&quot;</span>, lr);</div></div><!-- fragment --><h1><a class="anchor" id="formattypes"></a>
Supported dataset types</h1>
<p>Datasets in mlpack are represented internally as sparse or dense numeric matrices (specifically, as <code>arma::mat</code> or <code>arma::sp_mat</code> or similar). This means that when datasets are loaded from file, they must be converted to a suitable numeric representation. Therefore, in general, datasets on disk should contain only numeric features in order to be loaded successfully by mlpack.</p>
<p>The types of datasets that mlpack can load are roughly the same as the types of matrices that Armadillo can load. However, the load functionality that mlpack provides <b>only supports loading dense datasets</b>. When datasets are loaded by mlpack, <b>the file's type is detected using the file's extension</b>. mlpack supports the following file types:</p>
<ul>
<li>csv (comma-separated values), denoted by .csv or .txt</li>
<li>tsv (tab-separated values), denoted by .tsv, .csv, or .txt</li>
<li>ASCII (raw ASCII, with space-separated values), denoted by .txt</li>
<li>Armadillo ASCII (Armadillo's text format with a header), denoted by .txt</li>
<li>PGM, denoted by .pgm</li>
<li>PPM, denoted by .ppm</li>
<li>Armadillo binary, denoted by .bin</li>
<li>Raw binary, denoted by .bin <b>(note: this will be loaded as one-dimensional data, which is likely not what is desired.)</b></li>
<li>HDF5, denoted by .hdf, .hdf5, .h5, or .he5 (<b>note: HDF5 must be enabled in the Armadillo configuration</b>)</li>
<li>ARFF, denoted by .arff (<b>note: this is not supported by all mlpack command-line programs </b>; see <a class="el" href="formatdoc.html#formatcat">Categorical features and command line programs</a>)</li>
</ul>
<p>Datasets that are loaded by mlpack should be stored with <b>one row for one point</b> and <b>one column for one dimension</b>. Therefore, a dataset with three two-dimensional points <img class="formulaInl" alt="$(0, 1)$" src="form_171.png"/>, <img class="formulaInl" alt="$(3, 1)$" src="form_172.png"/>, and <img class="formulaInl" alt="$(5, -5)$" src="form_173.png"/> would be stored in a csv file as:</p>
<div class="fragment"><div class="line">0, 1</div><div class="line">3, 1</div><div class="line">5, -5</div></div><!-- fragment --><p>As noted earlier, for command-line programs, the format is automatically detected at load time. Therefore, a dataset can be loaded in many ways:</p>
<div class="fragment"><div class="line">$ mlpack_logistic_regression -t dataset.csv -v</div><div class="line">[INFO ] Loading <span class="stringliteral">&#39;dataset.csv&#39;</span> as CSV data.  Size is 32 x 37749.</div><div class="line">...</div><div class="line"></div><div class="line">$ mlpack_logistic_regression -t dataset.txt -v</div><div class="line">[INFO ] Loading <span class="stringliteral">&#39;dataset.txt&#39;</span> as raw ASCII formatted data.  Size is 32 x 37749.</div><div class="line">...</div><div class="line"></div><div class="line">$ mlpack_logistic_regression -t dataset.h5 -v</div><div class="line">[INFO ] Loading <span class="stringliteral">&#39;dataset.h5&#39;</span> as HDF5 data.  Size is 32 x 37749.</div><div class="line">...</div></div><!-- fragment --><p>Similarly, the format to save to is detected by the extension of the given filename.</p>
<h1><a class="anchor" id="formatcpp"></a>
Loading simple matrices in C++</h1>
<p>When C++ is being written, the <a class="el" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831" title="Loads a matrix from file, guessing the filetype from the extension. ">mlpack::data::Load()</a> and <a class="el" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313" title="Saves a matrix to file, guessing the filetype from the extension. ">mlpack::data::Save()</a> functions are used to load and save datasets, respectively. These functions should be preferred over the built-in Armadillo <code></code>.load() and <code></code>.save() functions.</p>
<p>Matrices in mlpack are column-major, meaning that each column should correspond to a point in the dataset and each row should correspond to a dimension; for more information, see <a class="el" href="matrices.html">Matrices in mlpack</a>. This is at odds with how the data is stored in files; therefore, a transposition is required during load and save. The <a class="el" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831" title="Loads a matrix from file, guessing the filetype from the extension. ">mlpack::data::Load()</a> and <a class="el" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313" title="Saves a matrix to file, guessing the filetype from the extension. ">mlpack::data::Save()</a> functions do this automatically (unless otherwise specified), which is why they are preferred over the Armadillo functions.</p>
<p>To load a matrix from file, the call is straightforward. After creating a matrix object, the data can be loaded:</p>
<div class="fragment"><div class="line">arma::mat dataset; <span class="comment">// The data will be loaded into this matrix.</span></div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">mlpack::data::Load</a>(<span class="stringliteral">&quot;dataset.csv&quot;</span>, dataset);</div></div><!-- fragment --><p>Saving matrices is equally straightforward. The code below generates a random matrix with 10 points in 3 dimensions and saves it to a file as HDF5.</p>
<div class="fragment"><div class="line"><span class="comment">// 3 dimensions (rows), with 10 points (columns).</span></div><div class="line">arma::mat dataset = arma::randu&lt;arma::mat&gt;(3, 10);</div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313">mlpack::data::Save</a>(<span class="stringliteral">&quot;dataset.h5&quot;</span>, dataset);</div></div><!-- fragment --><p>As with the command-line programs, the type of data to be loaded is automatically detected from the filename extension. For more details, see the <a class="el" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831" title="Loads a matrix from file, guessing the filetype from the extension. ">mlpack::data::Load()</a> and <a class="el" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313" title="Saves a matrix to file, guessing the filetype from the extension. ">mlpack::data::Save()</a> documentation.</p>
<h1><a class="anchor" id="sparseload"></a>
Dealing with sparse matrices</h1>
<p>As mentioned earlier, support for loading sparse matrices in mlpack is not available at this time. To use a sparse matrix with mlpack code, you will have to write a C++ program instead of using any of the command-line tools, because the command-line tools all use dense datasets internally. (There is one exception: the <code>mlpack_cf</code> program, for collaborative filtering, loads sparse coordinate lists.)</p>
<p>In addition, the <code><a class="el" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831" title="Loads a matrix from file, guessing the filetype from the extension. ">mlpack::data::Load()</a></code> function does not support loading any sparse format; so the best idea is to use undocumented Armadillo functionality to load coordinate lists. Suppose you have a coordinate list file like the one below:</p>
<div class="fragment"><div class="line">$ cat cl.csv</div><div class="line">0 0 0.332</div><div class="line">1 3 3.126</div><div class="line">4 4 1.333</div></div><!-- fragment --><p>This represents a 5x5 matrix with three nonzero elements. We can load this using Armadillo:</p>
<div class="fragment"><div class="line">arma::sp_mat matrix;</div><div class="line">matrix.load(<span class="stringliteral">&quot;cl.csv&quot;</span>, arma::coord_ascii);</div><div class="line">matrix = matrix.t(); <span class="comment">// We must transpose after load!</span></div></div><!-- fragment --><p>The transposition after loading is necessary if the coordinate list is in row-major format (that is, if each row in the matrix represents a point and each column represents a feature). Be sure that the matrix you use with mlpack methods has points as columns and features as rows! See <a class="el" href="matrices.html">Matrices in mlpack</a> for more information.</p>
<h1><a class="anchor" id="formatcat"></a>
Categorical features and command line programs</h1>
<p>In some situations it is useful to represent data not just as a numeric matrix but also as categorical data (i.e. with numeric but unordered categories). This support is useful for, e.g., decision trees and other models that support categorical features.</p>
<p>In some machine learning situations, such as, e.g., decision trees, categorical data can be used. Categorical data might look like this (in CSV format):</p>
<div class="fragment"><div class="line">0, 1, <span class="stringliteral">&quot;true&quot;</span>, 3</div><div class="line">5, -2, <span class="stringliteral">&quot;false&quot;</span>, 5</div><div class="line">2, 2, <span class="stringliteral">&quot;true&quot;</span>, 4</div><div class="line">3, -1, <span class="stringliteral">&quot;true&quot;</span>, 3</div><div class="line">4, 4, <span class="stringliteral">&quot;not sure&quot;</span>, 0</div><div class="line">0, 7, <span class="stringliteral">&quot;false&quot;</span>, 6</div></div><!-- fragment --><p>In the example above, the third dimension (which takes values "true", "false", and "not sure") is categorical. mlpack can load and work with this data, but the strings must be mapped to numbers, because all dataset in mlpack are represented by Armadillo matrix objects.</p>
<p>From the perspective of an mlpack command-line program, this support is transparent; mlpack will attempt to load the data file, and if it detects entries in the file that are not numeric, it will map them to numbers and then print, for each dimension, the number of mappings. For instance, if we run the <code>mlpack_hoeffding_tree</code> program (which supports categorical data) on the dataset above (stored as dataset.csv), we receive this output during loading:</p>
<div class="fragment"><div class="line">$ mlpack_hoeffding_tree -t dataset.csv -l dataset.labels.csv -v</div><div class="line">[INFO ] Loading <span class="stringliteral">&#39;dataset.csv&#39;</span> as CSV data.  Size is 6 x 4.</div><div class="line">[INFO ] 0 mappings in dimension 0.</div><div class="line">[INFO ] 0 mappings in dimension 1.</div><div class="line">[INFO ] 3 mappings in dimension 2.</div><div class="line">[INFO ] 0 mappings in dimension 3.</div><div class="line">...</div></div><!-- fragment --><p>Currently, only the <code>mlpack_hoeffding_tree</code> program supports loading categorical data, and this is also the only program that supports loading an ARFF dataset.</p>
<h1><a class="anchor" id="formatcatcpp"></a>
Categorical features and C++</h1>
<p>When writing C++, loading categorical data is slightly more tricky: the mappings from strings to integers must be preserved. This is the purpose of the <a class="el" href="namespacemlpack_1_1data.html#aa243ad7e4d29363b858bbc92b732921d">mlpack::data::DatasetInfo</a> class, which stores these mappings and can be used and load and save time to apply and de-apply the mappings.</p>
<p>When loading a dataset with categorical data, the overload of <a class="el" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831" title="Loads a matrix from file, guessing the filetype from the extension. ">mlpack::data::Load()</a> that takes an <a class="el" href="namespacemlpack_1_1data.html#aa243ad7e4d29363b858bbc92b732921d">mlpack::data::DatasetInfo</a> object should be used. An example is below:</p>
<div class="fragment"><div class="line">arma::mat dataset; <span class="comment">// Load into this matrix.</span></div><div class="line"><a class="code" href="classmlpack_1_1data_1_1DatasetMapper.html">mlpack::data::DatasetInfo</a> info; <span class="comment">// Store information about dataset in this.</span></div><div class="line"></div><div class="line"><span class="comment">// Load the ARFF dataset.</span></div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">mlpack::data::Load</a>(<span class="stringliteral">&quot;dataset.arff&quot;</span>, dataset, info);</div></div><!-- fragment --><p>After this load completes, the <code>info</code> object will hold the information about the mappings necessary to load the dataset. It is possible to re-use the <code>DatasetInfo</code> object to load another dataset with the same mappings. This is useful when, for instance, both a training and test set are being loaded, and it is necessary that the mappings from strings to integers for categorical features are identical. An example is given below.</p>
<div class="fragment"><div class="line">arma::mat trainingData; <span class="comment">// Load training data into this matrix.</span></div><div class="line"><a class="code" href="classmlpack_1_1data_1_1DatasetMapper.html">mlpack::data::DatasetInfo</a> info; <span class="comment">// This will store the mappings.</span></div><div class="line"></div><div class="line"><span class="comment">// Load the training data, and create the mappings in the &#39;info&#39; object.</span></div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">mlpack::data::Load</a>(<span class="stringliteral">&quot;training_data.arff&quot;</span>, trainingData, info);</div><div class="line"></div><div class="line"><span class="comment">// Load the test data, but re-use the &#39;info&#39; object with the already initialized</span></div><div class="line"><span class="comment">// mappings.  This means that the same mappings will be applied to the test set.</span></div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">mlpack::data::Load</a>(<span class="stringliteral">&quot;test_data.arff&quot;</span>, trainingData, info);</div></div><!-- fragment --><p>When saving data, pass the same DatasetInfo object it was loaded with in order to unmap the categorical features correctly. The example below demonstrates this functionality: it loads the dataset, increments all non-categorical features by 1, and then saves the dataset with the same DatasetInfo it was loaded with.</p>
<div class="fragment"><div class="line">arma::mat dataset; <span class="comment">// Load data into this matrix.</span></div><div class="line"><a class="code" href="classmlpack_1_1data_1_1DatasetMapper.html">mlpack::data::DatasetInfo</a> info; <span class="comment">// This will store the mappings.</span></div><div class="line"></div><div class="line"><span class="comment">// Load the dataset.</span></div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">mlpack::data::Load</a>(<span class="stringliteral">&quot;dataset.tsv&quot;</span>, dataset, info);</div><div class="line"></div><div class="line"><span class="comment">// Loop over all features, and add 1 to all non-categorical features.</span></div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; info.<a class="code" href="classmlpack_1_1data_1_1DatasetMapper.html#a78eda6bfb9e9462afa0fc85e32abe1af">Dimensionality</a>(); ++i)</div><div class="line">{</div><div class="line">  <span class="comment">// The Type() function returns whether or not the data is numeric or</span></div><div class="line">  <span class="comment">// categorical.</span></div><div class="line">  <span class="keywordflow">if</span> (info.<a class="code" href="classmlpack_1_1data_1_1DatasetMapper.html#af46c276f8b3c130454e23447bcb959e4">Type</a>(i) != <a class="code" href="namespacemlpack_1_1data.html#aa7714fa0b7efc7b31cbda21da607c5b6a2992a7ab833605792145cd40762644c7">mlpack::data::Datatype::categorical</a>)</div><div class="line">    dataset.row(i) += 1.0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Save the modified dataset using the same DatasetInfo.</span></div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313">mlpack::data::Save</a>(<span class="stringliteral">&quot;dataset-new.tsv&quot;</span>, dataset, info);</div></div><!-- fragment --><p>There is more functionality to the DatasetInfo class; for more information, see the <a class="el" href="namespacemlpack_1_1data.html#aa243ad7e4d29363b858bbc92b732921d">mlpack::data::DatasetInfo</a> documentation.</p>
<h1><a class="anchor" id="intro_imagetut"></a>
Loading and Saving Images</h1>
<p>Image datasets are becoming increasingly popular in deep learning.</p>
<p>mlpack's image saving/loading functionality is based on <a href="https://github.com/nothings/stb">stb/</a>.</p>
<h1><a class="anchor" id="model_api_imagetut"></a>
Image Utilities API</h1>
<p>Image utilities supports loading and saving of images.</p>
<p>It supports filetypes "jpg", "png", "tga", "bmp", "psd", "gif", "hdr", "pic", "pnm" for loading and "jpg", "png", "tga", "bmp", "hdr" for saving.</p>
<p>The datatype associated is unsigned char to support RGB values in the range 1-255. To feed data into the network typecast of <code>arma::Mat</code> may be required. Images are stored in the matrix as (width * height * channels, NumberOfImages). Therefore <code>imageMatrix.col(0)</code> would be the first image if images are loaded in <code>imageMatrix</code>.</p>
<h1><a class="anchor" id="imageinfo_api_imagetut"></a>
Accessing Metadata of Images: ImageInfo</h1>
<p>ImageInfo class contains the metadata of the images. </p><div class="fragment"><div class="line">ImageInfo(<span class="keyword">const</span> <span class="keywordtype">size_t</span> width,</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">size_t</span> height,</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">size_t</span> channels,</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">size_t</span> quality = 90);</div></div><!-- fragment --><p>The <code>quality</code> member denotes the compression of the image if it is saved as <code>jpg</code>; it takes values from 0 to 100.</p>
<h1><a class="anchor" id="load_api_imagetut"></a>
Loading Images in C++</h1>
<p>Standalone loading of images.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> eT&gt;</div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">Load</a>(<span class="keyword">const</span> std::string&amp; filename,</div><div class="line">          arma::Mat&lt;eT&gt;&amp; matrix,</div><div class="line">          ImageInfo&amp; info,</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">bool</span> fatal);</div></div><!-- fragment --><p>The example below loads a test image. It also fills up the ImageInfo class object.</p>
<div class="fragment"><div class="line">data::ImageInfo info;</div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">data::Load</a>(<span class="stringliteral">&quot;test_image.png&quot;</span>, matrix, info, <span class="keyword">false</span>);</div></div><!-- fragment --><p>ImageInfo requires height, width, number of channels of the image.</p>
<div class="fragment"><div class="line"><span class="keywordtype">size_t</span> height = 64, width = 64, channels = 1;</div><div class="line">data::ImageInfo info(width, height, channels);</div></div><!-- fragment --><p>More than one image can be loaded into the same matrix.</p>
<p>Loading multiple images:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> eT&gt;</div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">Load</a>(<span class="keyword">const</span> std::vector&lt;std::string&gt;&amp; files,</div><div class="line">          arma::Mat&lt;eT&gt;&amp; matrix,</div><div class="line">          ImageInfo&amp; info,</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">bool</span> fatal);</div></div><!-- fragment --><div class="fragment"><div class="line">data::ImageInfo info;</div><div class="line">std::vector&lt;std::string&gt;&gt; files{<span class="stringliteral">&quot;test_image1.bmp&quot;</span>,<span class="stringliteral">&quot;test_image2.bmp&quot;</span>};</div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">data::Load</a>(files, matrix, info, <span class="keyword">false</span>);</div></div><!-- fragment --><h1><a class="anchor" id="save_api_imagetut"></a>
Saving Images in C++</h1>
<p>Save images expects a matrix of type unsigned char in the form (width * height * channels, NumberOfImages). Just like load it can be used to save one image or multiple images. Besides image data it also expects the shape of the image as input (width, height, channels).</p>
<p>Saving one image:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> eT&gt;</div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313">Save</a>(<span class="keyword">const</span> std::string&amp; filename,</div><div class="line">          arma::Mat&lt;eT&gt;&amp; matrix,</div><div class="line">          ImageInfo&amp; info,</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">bool</span> fatal,</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">bool</span> transpose);</div></div><!-- fragment --><div class="fragment"><div class="line">data::ImageInfo info;</div><div class="line">info.width = info.height = 25;</div><div class="line">info.channels = 3;</div><div class="line">info.quality = 90;</div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313">data::Save</a>(<span class="stringliteral">&quot;test_image.bmp&quot;</span>, matrix, info, <span class="keyword">false</span>, <span class="keyword">true</span>);</div></div><!-- fragment --><p>If the matrix contains more than one image, only the first one is saved.</p>
<p>Saving multiple images:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> eT&gt;</div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313">Save</a>(<span class="keyword">const</span> std::vector&lt;std::string&gt;&amp; files,</div><div class="line">          arma::Mat&lt;eT&gt;&amp; matrix,</div><div class="line">          ImageInfo&amp; info,</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">bool</span> fatal,</div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">bool</span> transpose);</div></div><!-- fragment --><div class="fragment"><div class="line">data::ImageInfo info;</div><div class="line">info.width = info.height = 25;</div><div class="line">info.channels = 3;</div><div class="line">info.quality = 90;</div><div class="line">std::vector&lt;std::string&gt;&gt; files{<span class="stringliteral">&quot;test_image1.bmp&quot;</span>, <span class="stringliteral">&quot;test_image2.bmp&quot;</span>};</div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313">data::Save</a>(files, matrix, info, <span class="keyword">false</span>, <span class="keyword">true</span>);</div></div><!-- fragment --><p>Multiple images are saved according to the vector of filenames specified.</p>
<h1><a class="anchor" id="formatmodels"></a>
Loading and saving models</h1>
<p>Using <code>cereal</code>, mlpack is able to load and save machine learning models with ease. These models can currently be saved in three formats:</p>
<ul>
<li>binary (.bin); this is not human-readable, but it is small</li>
<li>json (.json); this is sort of human-readable and relatively small</li>
<li>xml (.xml); this is human-readable but very verbose and large</li>
</ul>
<p>The type of file to save is determined by the given file extension, as with the other loading and saving functionality in mlpack. Below is an example where a dataset stored as TSV and labels stored as ASCII text are used to train a logistic regression model, which is then saved to model.xml.</p>
<div class="fragment"><div class="line">$ mlpack_logistic_regression -t training_dataset.tsv -l training_labels.txt \</div><div class="line">&gt; -M model.xml</div></div><!-- fragment --><p>Many mlpack command-line programs have support for loading and saving models through the <code>&ndash;input_model_file</code> (<code>-m</code>) and <code>&ndash;output_model_file</code> (<code>-M</code>) options; for more information, see the documentation for each program (accessible by passing <code>&ndash;help</code> as a parameter).</p>
<h1><a class="anchor" id="formatmodelscpp"></a>
Loading and saving models in C++</h1>
<p>mlpack uses the <code>cereal</code> library internally to perform loading and saving of models, and provides convenience overloads of <a class="el" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831" title="Loads a matrix from file, guessing the filetype from the extension. ">mlpack::data::Load()</a> and <a class="el" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313" title="Saves a matrix to file, guessing the filetype from the extension. ">mlpack::data::Save()</a> to load and save these models.</p>
<p>To be serializable, a class must implement the method</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Archive&gt;</div><div class="line"><span class="keywordtype">void</span> serialize(Archive&amp; ar);</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>For more information on this method and how it works, see the cereal documentation at <a href="https://uscilab.github.io/cereal/index.html">https://uscilab.github.io/cereal/index.html</a>.</dd>
<dd>
Examples of serialize() methods can be found in most classes; one fairly straightforward example is found in the mlpack::math::Range class. A more complex example is found <a class="el" href="classmlpack_1_1tree_1_1BinarySpaceTree.html#a72d63b74c8166dff8e1a9006905ad9ca">in the mlpack::tree::BinarySpaceTree class</a>.</dd></dl>
<p>Using the <a class="el" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831" title="Loads a matrix from file, guessing the filetype from the extension. ">mlpack::data::Load()</a> and <a class="el" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313" title="Saves a matrix to file, guessing the filetype from the extension. ">mlpack::data::Save()</a> classes is easy if the type being saved has a <code>serialize()</code> method implemented: simply call either function with a filename, a name for the object to save, and the object itself. The example below, for instance, creates an mlpack::math::Range object and saves it as range.txt. Then, that range is loaded from file into another mlpack::math::Range object.</p>
<div class="fragment"><div class="line"><span class="comment">// Create range and save it.</span></div><div class="line">mlpack::math::Range r(0.0, 5.0);</div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313">mlpack::data::Save</a>(<span class="stringliteral">&quot;range.json&quot;</span>, <span class="stringliteral">&quot;range&quot;</span>, r);</div><div class="line"></div><div class="line"><span class="comment">// Load into new range.</span></div><div class="line">mlpack::math::Range newRange;</div><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">mlpack::data::Load</a>(<span class="stringliteral">&quot;range.json&quot;</span>, <span class="stringliteral">&quot;range&quot;</span>, newRange);</div></div><!-- fragment --><p>It is important to be sure that you load the appropriate type; if you save, for instance, an <a class="el" href="classmlpack_1_1regression_1_1LogisticRegression.html" title="The LogisticRegression class implements an L2-regularized logistic regression model, and supports training with multiple optimizers and classification. ">mlpack::regression::LogisticRegression</a> object and attempt to load it as an mlpack::math::Range object, the load will fail and an exception will be thrown. (When the object is saved as binary (.bin), it is possible that the load will not fail, but instead load with mangled data, which is perhaps even worse!)</p>
<h1><a class="anchor" id="formatfinal"></a>
Final notes</h1>
<p>If the examples here are unclear, it would be worth looking into the ways that <a class="el" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831" title="Loads a matrix from file, guessing the filetype from the extension. ">mlpack::data::Load()</a> and <a class="el" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313" title="Saves a matrix to file, guessing the filetype from the extension. ">mlpack::data::Save()</a> are used in the code. Some example files that may be useful to this end:</p>
<ul>
<li>src/mlpack/methods/logistic_regression/logistic_regression_main.cpp</li>
<li>src/mlpack/methods/hoeffding_trees/hoeffding_tree_main.cpp</li>
<li>src/mlpack/methods/neighbor_search/knn_main.cpp</li>
</ul>
<p>If you are interested in adding support for more data types to mlpack, it would be preferable to add the support upstream to Armadillo instead, so that may be a better direction to go first. Then very little code modification for mlpack will be necessary. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
<script type="text/javascript">
var x = document.querySelectorAll("img.formulaDsp");
var i;
for (i = 0; i < x.length; i++)
{
  x[i].width = x[i].offsetWidth / 4;
}
</script>
</html>
